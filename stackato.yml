name: wordpress
instances: 1
framework: php
mem: 128M
min_version:
  client: 1.4.3
  server: 1.0
services:
  ${name}-db: mysql
  ${name}-fs: filesystem
hooks:
  pre-staging:
    # Add a bit of salt (secure)
    - echo "<?php" > wp-salt.php
    - curl -s https://api.wordpress.org/secret-key/1.1/salt/ >> wp-salt.php
    - echo "?>" >> wp-salt.php
 
  post-staging:
    # create wp-content in the shared filesystem and migrate 
    - mkdir -p "$STACKATO_FILESYSTEM"/wp-content
    - cp -r wp-content/* "$STACKATO_FILESYSTEM"/wp-content
    
    # remove unused directories
    - rm -rf wp-content
  
    # link to wp-content folder in the shared filesystem
    - ln -s "$STACKATO_FILESYSTEM"/wp-content wp-content
